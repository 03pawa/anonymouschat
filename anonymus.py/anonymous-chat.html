<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anonymous Chat - Omegle Style</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #fff;
            height: 100vh;
            overflow: hidden;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 100%;
        }
        
        header {
            text-align: center;
            padding: 15px 0;
            background: rgba(0, 0, 0, 0.7);
            border-bottom: 1px solid #444;
        }
        
        header h1 {
            font-size: 2rem;
            font-weight: 300;
            letter-spacing: 1px;
        }
        
        .app-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        /* Registration Panel - Omegle Style */
        #registrationPanel {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            padding: 20px;
            background: rgba(0, 0, 0, 0.8);
        }
        
        .registration-box {
            background: rgba(30, 30, 46, 0.9);
            border-radius: 10px;
            padding: 30px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            border: 1px solid #444;
        }
        
        .registration-box h2 {
            text-align: center;
            margin-bottom: 20px;
            font-weight: 300;
            color: #64b5f6;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: #bbb;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #444;
            border-radius: 4px;
            background: rgba(20, 20, 30, 0.8);
            color: #fff;
            font-size: 1rem;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #64b5f6;
            box-shadow: 0 0 0 2px rgba(100, 181, 246, 0.3);
        }
        
        .terms-section {
            margin: 20px 0;
            font-size: 0.85rem;
            color: #aaa;
        }
        
        .terms-section label {
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        
        .terms-section input {
            margin-top: 3px;
        }
        
        .terms-section a {
            color: #64b5f6;
            text-decoration: none;
        }
        
        .terms-section a:hover {
            text-decoration: underline;
        }
        
        .btn {
            background: #64b5f6;
            color: #000;
            border: none;
            padding: 14px;
            font-size: 1.1rem;
            font-weight: 600;
            width: 100%;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn:hover {
            background: #42a5f5;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(100, 181, 246, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: #424242;
            color: #fff;
        }
        
        .btn-secondary:hover {
            background: #616161;
            box-shadow: 0 5px 15px rgba(98, 98, 98, 0.4);
        }
        
        /* Waiting Room */
        #waitingPanel {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            padding: 20px;
            background: rgba(0, 0, 0, 0.8);
            text-align: center;
        }
        
        .waiting-content {
            background: rgba(30, 30, 46, 0.9);
            border-radius: 10px;
            padding: 40px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            border: 1px solid #444;
        }
        
        .waiting-content h3 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #64b5f6;
            font-weight: 300;
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 4px solid #64b5f6;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 30px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Chat Room */
        #chatPanel {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
        }
        
        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.7);
            border-bottom: 1px solid #444;
        }
        
        .chat-header h2 {
            font-size: 1.2rem;
            font-weight: 400;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
            background-color: #4caf50;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: rgba(20, 20, 30, 0.7);
        }
        
        .message {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message.me {
            align-items: flex-end;
        }
        
        .message.partner {
            align-items: flex-start;
        }
        
        .message.system {
            align-items: center;
        }
        
        .message-content {
            max-width: 80%;
            padding: 12px 15px;
            border-radius: 18px;
            word-wrap: break-word;
            font-size: 1rem;
            line-height: 1.4;
        }
        
        .message.me .message-content {
            background: #64b5f6;
            color: #000;
            border-bottom-right-radius: 4px;
        }
        
        .message.partner .message-content {
            background: #424242;
            color: #fff;
            border-bottom-left-radius: 4px;
        }
        
        .message.system .message-content {
            background: rgba(30, 30, 46, 0.9);
            color: #bbb;
            font-size: 0.9rem;
            text-align: center;
            border-radius: 20px;
        }
        
        .message-timestamp {
            font-size: 0.7rem;
            color: #aaa;
            margin-top: 5px;
        }
        
        .message.me .message-timestamp {
            text-align: right;
        }
        
        .message.partner .message-timestamp {
            text-align: left;
        }
        
        .chat-input-container {
            display: flex;
            padding: 15px;
            background: rgba(0, 0, 0, 0.7);
            border-top: 1px solid #444;
        }
        
        .chat-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #444;
            border-radius: 20px;
            background: rgba(30, 30, 46, 0.9);
            color: #fff;
            margin-right: 10px;
            font-size: 1rem;
        }
        
        .chat-input:focus {
            outline: none;
            border-color: #64b5f6;
            box-shadow: 0 0 0 2px rgba(100, 181, 246, 0.3);
        }
        
        .send-btn {
            background: #64b5f6;
            color: #000;
            border: none;
            border-radius: 20px;
            padding: 12px 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .send-btn:hover {
            background: #42a5f5;
            transform: translateY(-2px);
        }
        
        .disconnect-btn {
            background: #f44336;
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 8px 15px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .disconnect-btn:hover {
            background: #d32f2f;
            transform: translateY(-2px);
        }
        
        .hidden {
            display: none;
        }
        
        footer {
            text-align: center;
            padding: 15px;
            font-size: 0.8rem;
            color: #777;
            background: rgba(0, 0, 0, 0.7);
            border-top: 1px solid #444;
        }
        
        @media (max-width: 768px) {
            .registration-box, .waiting-content {
                margin: 10px;
                padding: 20px;
            }
            
            .message-content {
                max-width: 90%;
            }
            
            header h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Anonymous Chat</h1>
        </header>
        
        <div class="app-container">
            <!-- Registration Panel -->
            <div id="registrationPanel">
                <div class="registration-box">
                    <h2>Connect with Strangers</h2>
                    <p style="text-align: center; margin-bottom: 20px; color: #bbb;">Chat with random people around the world</p>
                    
                    <form id="registrationForm">
                        <div class="form-group">
                            <label for="interests">Your Interests (comma separated):</label>
                            <input type="text" id="interests" name="interests" placeholder="e.g., technology, music, sports">
                        </div>
                        
                        <div class="form-group">
                            <label for="education">Education Level:</label>
                            <select id="education" name="education">
                                <option value="">Select your education level</option>
                                <option value="high-school">High School</option>
                                <option value="associate">Associate Degree</option>
                                <option value="bachelor">Bachelor's Degree</option>
                                <option value="master">Master's Degree</option>
                                <option value="doctorate">Doctorate</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div class="terms-section">
                            <label>
                                <input type="checkbox" id="terms" required>
                                I agree to the <a href="#" id="termsLink">terms of service</a> and understand that illegal activities will result in account prohibition.
                            </label>
                        </div>
                        
                        <button type="submit" class="btn">Start Chatting</button>
                    </form>
                </div>
            </div>
            
            <!-- Waiting Room -->
            <div class="hidden" id="waitingPanel">
                <div class="waiting-content">
                    <h3>Finding you a match...</h3>
                    <div class="spinner"></div>
                    <p style="color: #bbb; margin-bottom: 20px;">Please wait while we connect you with a random stranger.</p>
                    <button class="btn btn-secondary" id="cancelMatchBtn">Cancel</button>
                </div>
            </div>
            
            <!-- Chat Room -->
            <div class="hidden" id="chatPanel">
                <div class="chat-header">
                    <div>
                        <span class="status-indicator"></span>
                        <strong>Anonymous Stranger</strong>
                    </div>
                    <button class="disconnect-btn" id="disconnectBtn">Disconnect</button>
                </div>
                
                <div class="chat-messages" id="chatMessages">
                    <div class="message system">
                        <div class="message-content">
                            You're now chatting with a random stranger. Say hello!
                        </div>
                    </div>
                </div>
                
                <div class="chat-input-container">
                    <input type="text" id="messageInput" class="chat-input" placeholder="Type your message...">
                    <button id="sendBtn" class="send-btn">Send</button>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Â© 2025 Anonymous Chat. All interactions are monitored for safety.</p>
            <p>Illegal activities will result in account prohibition.</p>
        </footer>
    </div>

    <script>
        // DOM Elements
        const registrationPanel = document.getElementById('registrationPanel');
        const waitingPanel = document.getElementById('waitingPanel');
        const chatPanel = document.getElementById('chatPanel');
        const registrationForm = document.getElementById('registrationForm');
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const disconnectBtn = document.getElementById('disconnectBtn');
        const cancelMatchBtn = document.getElementById('cancelMatchBtn');
        const termsLink = document.getElementById('termsLink');
        
        // Application State
        let currentUser = null;
        let messages = [];
        let isConnected = false;
        let sessionId = null;
        
        // In-memory storage (simulating backend)
        const users = new Map();
        const waitingUsers = new Set();
        const matches = new Map();
        
        // Registration Form Handler
        registrationForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const interests = document.getElementById('interests').value;
            const education = document.getElementById('education').value;
            const termsAccepted = document.getElementById('terms').checked;
            
            if (!termsAccepted) {
                alert('Please accept the terms of service to continue.');
                return;
            }
            
            // Register user (simulated)
            const userId = 'user_' + Date.now();
            users.set(userId, {
                id: userId,
                interests: interests,
                education: education,
                createdAt: new Date()
            });
            
            currentUser = {
                id: userId,
                interests: interests,
                education: education
            };
            
            // Generate session ID
            sessionId = 'session_' + Date.now();
            
            // Show waiting panel
            registrationPanel.classList.add('hidden');
            waitingPanel.classList.remove('hidden');
            
            // Simulate matching process
            setTimeout(() => {
                findMatch(userId);
            }, 3000);
        });
        
        // Cancel Matching
        cancelMatchBtn.addEventListener('click', function() {
            waitingPanel.classList.add('hidden');
            registrationPanel.classList.remove('hidden');
            currentUser = null;
            sessionId = null;
        });
        
        // Disconnect from chat
        disconnectBtn.addEventListener('click', function() {
            disconnectChat();
        });
        
        // Function to disconnect chat
        function disconnectChat() {
            chatPanel.classList.add('hidden');
            registrationPanel.classList.remove('hidden');
            currentUser = null;
            messages = [];
            isConnected = false;
            sessionId = null;
            
            // Clear chat messages
            chatMessages.innerHTML = '<div class="message system"><div class="message-content">You\'re now chatting with a random stranger. Say hello!</div></div>';
        }
        
        // Send Message
        sendBtn.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // Function to send message with AI-based content moderation
        async function sendMessage() {
            const message = messageInput.value.trim();
            if (message && isConnected && sessionId) {
                // Send message to server for content checking
                try {
                    const response = await fetch('http://localhost:3001/send-message', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            sessionId: sessionId,
                            userId: currentUser.id,
                            message: message
                        })
                    });
                    
                    const result = await response.json();
                    
                    // Handle banned user
                    if (result.banned) {
                        // Show ban message
                        const messageObj = {
                            id: Date.now(),
                            text: "You have been permanently banned for violating our terms of service.",
                            sender: 'system',
                            timestamp: new Date()
                        };
                        
                        messages.push(messageObj);
                        displayMessage(messageObj);
                        
                        // Disconnect and prevent reconnection
                        setTimeout(() => {
                            disconnectChat();
                            // Show ban notification
                            alert("You have been permanently banned for inappropriate content.");
                            // Hide registration panel to prevent reconnection
                            registrationPanel.classList.add('hidden');
                            // Show banned message
                            const bannedPanel = document.createElement('div');
                            bannedPanel.className = 'registration-box';
                            bannedPanel.innerHTML = '<h2>Account Banned</h2><p>You have been permanently banned for violating our terms of service.</p><p>Reason: ' + (result.analysis ? result.analysis.detectedTerms.map(t => t.term).join(', ') : 'Inappropriate content') + '</p>';
                            document.querySelector('.app-container').appendChild(bannedPanel);
                        }, 3000);
                        
                        return;
                    }
                    
                    // Handle disconnection for inappropriate content
                    if (result.disconnected) {
                        // Show disconnection message
                        const messageObj = {
                            id: Date.now(),
                            text: "You have been disconnected for sending inappropriate content.",
                            sender: 'system',
                            timestamp: new Date()
                        };
                        
                        messages.push(messageObj);
                        displayMessage(messageObj);
                        
                        // Disconnect after a short delay
                        setTimeout(() => {
                            disconnectChat();
                        }, 3000);
                        
                        return;
                    }
                    
                    if (result.status === 'error') {
                        alert(result.message);
                        return;
                    }
                    
                    // Add to messages array
                    const messageObj = {
                        id: Date.now(),
                        text: message,
                        sender: 'me',
                        timestamp: new Date()
                    };
                    
                    messages.push(messageObj);
                    displayMessage(messageObj);
                    messageInput.value = '';
                    
                    // Simulate partner response after a delay
                    setTimeout(() => {
                        simulatePartnerResponse();
                    }, 1000 + Math.random() * 2000);
                } catch (error) {
                    console.error('Error sending message:', error);
                    alert('Error sending message. Please try again.');
                }
            }
        }
        
        function displayMessage(messageObj) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ' + messageObj.sender;
            
            const hours = messageObj.timestamp.getHours().toString().padStart(2, '0');
            const minutes = messageObj.timestamp.getMinutes().toString().padStart(2, '0');
            
            messageDiv.innerHTML = '<div class="message-content">' + messageObj.text + '</div><div class="message-timestamp">' + hours + ':' + minutes + '</div>';
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function simulatePartnerResponse() {
            if (!isConnected) return;
            
            const responses = [
                "That's interesting! Tell me more.",
                "I completely agree with you.",
                "I've had a similar experience.",
                "What else do you enjoy doing?",
                "That sounds fascinating!",
                "How long have you been interested in that?",
                "I'd love to hear your thoughts on this.",
                "Thanks for sharing that with me."
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            
            const messageObj = {
                id: Date.now(),
                text: randomResponse,
                sender: 'partner',
                timestamp: new Date()
            };
            
            messages.push(messageObj);
            displayMessage(messageObj);
        }
        
        // Simple matching algorithm
        function findMatch(userId) {
            // In a real app, this would connect to a backend service
            // For this demo, we'll simulate a match
            
            // Show chat panel
            waitingPanel.classList.add('hidden');
            chatPanel.classList.remove('hidden');
            isConnected = true;
            
            // Add system message
            const matchMessage = {
                id: Date.now(),
                text: "You've been matched with a random stranger! Say hello!",
                sender: 'system',
                timestamp: new Date()
            };
            
            messages.push(matchMessage);
            displayMessage(matchMessage);
        }
        
        // Terms of Service Modal
        termsLink.addEventListener('click', function(e) {
            e.preventDefault();
            
            const termsContent = '<h3>Terms of Service</h3><p><strong>Last Updated:</strong> November 1, 2025</p><h4>1. Acceptance of Terms</h4><p>By accessing or using the Anonymous Chat service, you agree to be bound by these Terms of Service.</p><h4>2. Privacy Policy</h4><p>We are committed to protecting your privacy:</p><ul><li>Your personal information is never shared with other users</li><li>Only your interests and education level are used for matching</li><li>All chat data is ephemeral and not stored permanently</li><li>Your identity remains anonymous to other users</li></ul><h4>3. Prohibited Activities</h4><p>You agree not to use the service to:</p><ul><li>Harass, abuse, or harm other users</li><li>Share illegal content or materials</li><li>Impersonate others or provide false information</li><li>Distribute spam or malicious content</li><li>Engage in any illegal activities</li></ul><h4>4. Abuse Reporting</h4><p>We take abuse seriously:</p><ul><li>Users can report abusive behavior at any time</li><li>Reported accounts are reviewed by our moderation team</li><li>Confirmed violations result in immediate account prohibition</li></ul><h4>5. Account Prohibition</h4><p>We reserve the right to:</p><ul><li>Prohibit accounts engaged in illegal activities</li><li>Remove content that violates our policies</li><li>Terminate access to the service for policy violations</li></ul><h4>6. Disclaimer</h4><p>The service is provided "as is" without warranties of any kind.</p><button id="closeTerms" class="btn">Close</button>';
            
            showTermsModal(termsContent);
        });
        
        function showTermsModal(content) {
            // Create modal overlay
            const overlay = document.createElement('div');
            overlay.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); display: flex; justify-content: center; align-items: center; z-index: 1000;';
            
            // Create modal content
            const modal = document.createElement('div');
            modal.style.cssText = 'background: rgba(30, 30, 46, 0.95); padding: 30px; border-radius: 10px; max-width: 700px; max-height: 85vh; overflow-y: auto; position: relative; color: #fff; box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);';
            
            modal.innerHTML = content;
            
            // Add close button functionality
            setTimeout(() => {
                const closeBtn = document.getElementById('closeTerms');
                if (closeBtn) {
                    closeBtn.addEventListener('click', function() {
                        document.body.removeChild(overlay);
                    });
                }
            }, 100);
            
            overlay.appendChild(modal);
            document.body.appendChild(overlay);
            
            // Close on overlay click
            overlay.addEventListener('click', function(e) {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            });
        }
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Anonymous Chat initialized');
        });
    </script>
</body>
</html>